name: PR Checks

on: [pull_request]

jobs:
  danger:
    name: Danger
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v1

    - name: Read .node-version
      id: node-version
      run: echo ::set-output name=version::$(cat .node-version)
    - name: Setup Node.js ${{ steps.node-version.outputs.version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ steps.node-version.outputs.version }}

    - name: yarn install
      run: cd DevelopmentDependencies && yarn install

    - name: Cache SwiftPM
      uses: actions/cache@v1
      with:
        path: DevelopmentDependencies/.build
        key: ${{ runner.os }}-swiftpm-dev-deps-${{ env.PWD }}-${{ hashFiles('DevelopmentDependencies/Package.resolved') }}
        restore-keys: |
          ${{ runner.os }}-swiftpm-dev-deps-${{ env.PWD }}
    - name: Run Danger
      run: cd DevelopmentDependencies && swift run --configuration release danger-swift ci --danger-js-path $(yarn bin danger) --verbose
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
